---
title: "Linux_base_01"
date: 2021-11-08T15:34:58+08:00
lastmod: 2021-11-08
tags: [linux]
categories: [Advanced learning]
slug: linux
draft: false
---
## 1. Linux 背景知识
Linux 有两种含义：
* 一种是 Linus 编写的开源操作系统的内核
* 另一种是广义的操作系统

执行环境
* 云主机
* 虚拟机（较推荐）
* 无数据的 PC（不推荐多系统混跑）

linux版本：   
* 内核版本
    * 内核版本分为三个部分 
        * 主版本号、次版本号、末版本号
    * 次版本号是奇数为开发版，偶数为稳定版

* 发行版本（因为linux是开源的）5种
    * Redhat Enterprise Linux:RedHat公司发行，软件经过专业人员的测试，非常稳定，但是需要付费。
    * Fedora发行版本，也是RadHat发行，组建一个社区免费提供这个操作系统，软件较新，但未经过RedHat的专业测试，稳定性较差。
    * centos，是基于Enterprise Linux 的源代码经行编译的，把RedHad的商标和字样去掉了，故免费。
    * Debian和Ubuntu 不是字符桌面，有图形界面。
## 2. 系统操作
### 帮助命令man help info
* manual: man ls;man 章节号 man；man -a passwd
* help: 内部命令(命令解释器shell自带的命令 type cd查看cd命令类型)：help cd 外部命令：ls --help
* info：比help 更详细，可以作为help的补充，全英文。
### linux文件管理
一切皆文件
windows里有注册表，资源管理器等组件，控制linux自身的统统都是文件，linux文件管理非常重要
### 文件查看
tab可以进行目录补全
* pwd
* cd
    * cd - 回到上次目录
    * cd ..(/)回到上一级目录
    * cd /path/to/…. 绝对路径
    * cd ./path/to/… 相对路径（./可以省略）
* ls
    * -l长格式显示（显示大小单位为Mb时可用-lh）
    * -a显示隐藏文件
    * -r逆序显示
    * -t时间顺序显示
    * -R递归显示
    - -F把文件按照类型归类，主要区分目录文件、可执行文件、链接文件，并且在末尾加上 / 、*、@符号标识
### 目录文件的创建和删除
只列出了少量命令
* mkdir
    * mkdir a b c
    * mkdir /a/b /a目录已存在
    * mkdir -p /a/b/c/d 无需a b c等目录存在
    * mkdir a b c -p  忽略已存在a b c 的报错
* rmdir 删除空目录，目录下有空目录也不行，体现了“一切皆文件”
* rm
    * -r -f（/rf） 可以删除非空目录，不去进行提示删除目录，具有一定危险性 eg: rm -r -f / a 不小心在/a之间加空格会导致删除所有目录且不提示
    * -i 删除前逐一询问确认
    * -f 即使原档案属性设为唯读，亦直接删除，无需逐一确认
    * -r 将目录及以下之档案亦逐一删除
* cp 
    * -r 复制⽬录
    * -p 保留访问权限、修改时间
    * -a 等同于 -dpR（保留权限、属组、修改时间）
    * -v 显示复制过程
* mv
    * mv /a /b将a改名为b（可与移动同时进行），在linux底层操作即进行了一个移动
* 更多命令见[命令大全](https://www.runoob.com/linux/linux-command-manual.html)
### 通配符（通用的匹配符号）
是shell内建的符号，用于多个相似的文件进行操作  
* *匹配任何字符串   
* ？匹配单个字符   
* [abc]匹配abc任意一个字符  
* [a-z]匹配一个范围   
* [!xyz]或[^xyz] 不匹配   
### 文件操作
#### 文本内容查看
* cat ⽂本内容显示到终端
* head 查看⽂件开头（默认10行，-5可显示5行）
* tail 查看⽂件结尾（行数同head）(-f可进行跟踪)
    - eg:tail -10 /etc/passwd 查看psaawd文件中倒数十行
* 常⽤参数 -f ⽂件内容更新后，显示信息同步更新
* wc 统计⽂件内容信息（-l查看行数）
* more 分行显示 （空格继续显示）
* less

more和less:
less:由于more不能后退，就取more的反义词less加上后退功能
所以Linux里流传着这样一句话："less is more".
总结下more 和 less的区别:
* less可以按键盘上下方向键显示上下内容,more不能这样
* less不必读整个文件，加载速度会比more更快
* less退出后shell不会留下刚显示的内容,而more退出后会在shell上留下刚显示的内容
#### 打包压缩解压
* 最早的 Linux 备份介质是磁带，使⽤的命令是 tar
* 可以打包后的磁带⽂件进⾏压缩储存，压缩的命令是 gzip 和 bzip2
* 经常使⽤的扩展名是 .tar.gz .tar.bz2 .tgz
* tar 打包命令
    * c 打包(cf  .tar)
    * x 解包
    * f 指定操作类型为⽂件
    * 可以使⽤ gzip 和 bzip2 命令单独操作通常和 tar 命令配合操作
    * -z gzip 格式压缩和解压缩(czf  .tar.gz)
    * -j bzip2 格式压缩和解压缩(cjf  .tar.bz2)，压缩比例更高，执行时间更慢。    
#### vim的四种模式
vim是一个vi向上兼容的文本编辑器，vim写的时候实际上是先复制一个隐藏文件，写入其中，保存退出时再用隐藏文件替换目的文件。
##### 正常模式
正常模式下输入：
* i:进入插入模式光标位置不动
* I:进入插入模式光标移到行首
* a:进入插入模式光标移到下一位
* A:进入插入模式光标移到行末
* o:进入插入模式光标在原来那一行的下一行，另起一行
* O:进入插入模式光标在原来那一行的上一行，另起一行
* ::进入命令模式
* hjkl:正常模式下光标上下左右移动
* 复制剪切粘贴输入错误进行重做
* y:
    * yy:光标在某一行输入n(不输入时默认为1，作为从当前行开始要复制的行数) yy，粘贴用p
    * y$:复制当前字符到行末的字符
* d:剪切
    * dd
    * d$
* u:撤销
* ctrl+r:重做
* x:单个字符删除
* r:替换当前字符
* n(你要移动光标到哪一行)+G
* g到第一行
* G到最后一行
* ^到当前行的开头
* $到当前行的结尾

##### 命令模式
文件的保存、退出、查找、替换，在正常模式下输入：
* w /test.txt 将文本保存到新文件，w直接保存到原始文件
* wq保存并推出
* q!不保存退出
* ！执行linux命令，有时候在打开vim的同时需要临时执行一条命令，eg:!ifconfig(查看ip地址)
* /查找eg:/x+enter光标自动移到第一个x,按n可以移动到下一个x，按N可以移到上一个x
* s/old/new 在光标所在行，将第一个旧的字符替换成新的字符
* %s/old/new 所有行，将第一个旧的字符替换成新的字符
* %s/old/new/g 所有行，将所有旧的字符替换成新的字符、
* n,m+前三个命令是在[n,m]行进行替换，左闭右闭
* set nohlsearch去除高亮显示
* set nu:显示行数
* set nonu:不显示行数
修改vim配置在/etc/vimrc文件里操作   
比如在最后一行添加set nu则以后每次打开文件都会显示行号

##### 可视模式
用于对文件进行重复的大量操作可以一次性执行完成
* v      字符可视模式
* V      行可视模式
* ctrl+v 块可视模式（用的最多）
* 配合d和I可以进行块的便利操作
    * eg:进入块可视模式，用hjkl选择一个块，I可以在块头插入比如abc再按两次esc可见每行都被插入了abc；选中一个块，按d直接删除块

### 用户和用户组管理及密码管理
windows linux都是多用户操作系统。只是windows的用户一般只有一个。

多用户操作系统的目的是隔离
- 用户权限隔离
- 系统资源隔离
- root 用户与普通用户的区别

用户管理常用命令
- useradd 新建用户
    - id+用户名 可显示相关信息（uid gid 以及组号）
- userdel 删除用户
    - 一般会加-r选项，因为如果不加，用户的家目录就会被保留下来，防止误删数据，加-r后都会删除
    - 可查看/etc/passwd  /etc/shadow
- passwd 修改用户密码
- usermod 修改用户属性
    - 可接很多属性如-a -c -d -e -g……。经常使用的一个属性是-d（用户的新登陆目录，家目录）
    - 修改用户组 eg: usermod -g group1 user1
- chage 修改用户属性
    - change age的缩写，可更改用户密码过期信息

组管理命令
- groupadd 新建用户组
    - 新建用户加入组有两种方法：
        - 先新建用户再用usermod -g
        - 直接useradd -g group1 user1
- groupdel 删除用户组

### su和sudo
用户切换
- su 切换用户
    - su - USERNAME 使用 login shell 方式切换用户
        -  -的作用是在用户切换的同时将运行环境也变更为目标用户的运行环境
        - 不带 - 为不完全切换，只切换了身份，需要额外切换目录
- sudo 以其他用户身份执行命令
    - visudo 设置需要使用 sudo 的用户（组）
```bash
#30分钟后关闭主机，需要管理员权限
shutdown -h 30
#停止关闭主机命令
shutdown -c 
```
vi sudo后可手动添加某用户权限eg:(A B=C )=(user1 ALL=/sbin/shutdown -c)
- 字符终端时B可以是localhost
- C是命令，在命令模式输入!which shutdown可得到shutdown命令的位置
- user1就被临时赋予了使用shutdown -c的权限
### 用户和用户组的配置文件介绍
用户配置文件
- /root root 用户的家目录
- /home/USERNAME 普通用户默认家目录位置
- /etc/passwd 用户配置文件
- /etc/shadow 用户密码相关配置文件
- /etc/group 用户组配置文件

### 文件和目录权限的表示方法
文件类型：
- \- 普通⽂件
- d ⽬录⽂件
- b 块特殊⽂件（块设备）
- c 字符特殊⽂件（字符设备）
- l 符号链接（快捷方式）
- f 命名管道
- s 套接字⽂件


字符权限表示方法
- r 读
- w 写
- x 执行

数字权限的表示方法
- r = 4 
- w = 2
- x = 1

\- rw- r-x r- - 1 userame groupname mtime filename
- rw- 文件属主的权限
- r-x 文件属组的权限 
- r- - 其他用户的权限
- 创建文件有默认权限，根据 umask 值计算



目录权限：
- x 进入目录
- rx 显示目录内的文件名
- wx 修改目录内的文件名

### 文件权限的修改方法和数字表示方法
修改权限：
- chmod 修改文件、目录权限
- chown 更改属主、属组
- chgrp 可以单独更改属组，不常用

特殊权限：
- SUID 用于二进制可执行文件，执行命令时取得文件属主权限
- SGID 用于目录，在该目录下创建新的文件和目录，权限自动更改为该目录的属组
- SBIT 用于目录，该目录下新建的文件和目录，仅 root 和自己可以删除

### 权限管理和文件的特殊权限
## 3. 服务管理
### 网络管理
### 查看、修改网络配置
### 网络故障排除
### 网络管理和配置文件
### 软件包管理器的使用及软件包的安装
#### rpm命令
#### yum包管理器
#### 源代码编译安装
### 内核升级
### grub配置文件介绍
### ps top查看进程
### 进程的控制、关联、通信
### 守护进程
### screen和系统日志
### 服务管理工具systemctl
### SElinux
### 内存和磁盘管理
#### 内存查看命令
#### 磁盘分区和文件大小查看
### 文件系统管理
### i节点和数据块操作
### 分区和挂载
#### 分区和挂载磁盘配额
### 交换分区swap的查看与创建
### 软件RAID的使用
### 逻辑卷LVM的用途与创建
### sar以及第三方命令
## 4. Shell
### 什么是shell
### linux的启动过程
### shell脚本
### 脚本不同执行方式的影响
### 管道
### 重定向
### 变量赋值
### 变量引用及作用范围
### 环境变量、预定义变量与位置变量
### 环境变量配置文件
### 数组
### 转义和引用
### 运算符
### 特殊字符大全
### test比较
### if判断的使用
#### if-else判断的使用
### 嵌套if的使用
### case分支
### for的基本使用
### c语言风格的for
### while循环和until循环
### 循环的嵌套和break、continue语句
### 使用循环处理位置参数
### 自定义参数
### 系统函数库介绍
### 脚本资源控制
### 信号
### 一次性计划任务
### 周期性计划任务
### 为脚本加锁
## 5. 文本操作
### 元字符介绍
### find演示
### sed和awk介绍
### sed替换命令讲解
#### 加强版
### sed的其他常用命令
### sed多行模式空间
### 什么是sed的保持空间
### awk
## 6. 服务篇
### 防火墙概述
### iptables
#### iptables规则的基本使用演示
#### iptables过滤规则的使用
#### iptables nat表的使用
### firewalld
### SSH
#### SSH介绍之Telent明文漏洞
#### SSH服务演示
### FTP服务器vsftpd介绍与软件包安装
### vsftpd配置文件介绍
#### vsftp虚拟用户
### sanba服务演示
### NFS服务
### Nginx基本配置文件
### 使用Nginx配置域名虚拟主机
### LNMP环境搭建
### DNS服务原理
### NAS演示
## 7. 实战

